# ğŸ”„ éåŒæœŸå‡¦ç†å…¥é–€ï¼šasync / await ã‚’ç†è§£ã—ã‚ˆã†

> **ã“ã®ç« ã§å­¦ã¶ã“ã¨:** JavaScriptã®éåŒæœŸå‡¦ç†ã®ä»•çµ„ã¿ã¨ã€VRMãƒ¢ãƒ‡ãƒ«èª­ã¿è¾¼ã¿ã§ã®æ´»ç”¨æ–¹æ³•

---

## ğŸ“š ç›®æ¬¡

1. [éåŒæœŸå‡¦ç†ã¨ã¯ï¼Ÿ](#1-éåŒæœŸå‡¦ç†ã¨ã¯)
2. [async / awaitã®åŸºæœ¬](#2-async--awaitã®åŸºæœ¬)
3. [try...catchã§ã‚¨ãƒ©ãƒ¼å‡¦ç†](#3-trycatchã§ã‚¨ãƒ©ãƒ¼å‡¦ç†)
4. [VRMã§ã®å®Ÿè·µä¾‹](#4-vrmã§ã®å®Ÿè·µä¾‹)
5. [ãƒãƒ£ãƒ¬ãƒ³ã‚¸å•é¡Œ](#5-ãƒãƒ£ãƒ¬ãƒ³ã‚¸å•é¡Œ)

---

## 1. éåŒæœŸå‡¦ç†ã¨ã¯ï¼Ÿ

### ğŸœ æ–™ç†ã«ä¾‹ãˆã¦ã¿ã‚ˆã†

ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã¯é€šå¸¸ã€ä¸Šã‹ã‚‰ä¸‹ã¸ä¸€è¡Œãšã¤å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚ã—ã‹ã—ã€ã€Œå¤§ããªãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã€ãªã©ã®å‡¦ç†ã¯æ™‚é–“ãŒã‹ã‹ã‚Šã¾ã™ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åŒæœŸå‡¦ç†ï¼ˆé€šå¸¸ï¼‰                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  ğŸœ ãƒ©ãƒ¼ãƒ¡ãƒ³ã‚’èŒ¹ã§ã‚‹                                     â”‚
â”‚       â†“                                                 â”‚
â”‚  â³ 3åˆ†é–“ã˜ã£ã¨å¾…ã¤...ï¼ˆä½•ã‚‚ã§ããªã„ï¼‰                    â”‚
â”‚       â†“                                                 â”‚
â”‚  ğŸ¥¢ æ¬¡ã®ä½œæ¥­ï¼ˆãƒˆãƒƒãƒ”ãƒ³ã‚°ï¼‰                               â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ éåŒæœŸå‡¦ç†ï¼ˆasync/awaitï¼‰                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  ğŸœ ãƒ©ãƒ¼ãƒ¡ãƒ³ã‚’èŒ¹ã§å§‹ã‚ã‚‹ + ã‚¿ã‚¤ãƒãƒ¼ã‚»ãƒƒãƒˆ                 â”‚
â”‚       â†“                                                 â”‚
â”‚  ğŸ¥¬ å¾…ã£ã¦ã„ã‚‹é–“ã«ãƒˆãƒƒãƒ”ãƒ³ã‚°æº–å‚™ï¼                       â”‚
â”‚       â†“                                                 â”‚
â”‚  â° ã‚¿ã‚¤ãƒãƒ¼é³´ã‚‹ï¼ˆawaitï¼‰â†’ èŒ¹ã§ä¸ŠãŒã‚Šï¼                  â”‚
â”‚       â†“                                                 â”‚
â”‚  ğŸœ ç››ã‚Šä»˜ã‘                                             â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. async / awaitã®åŸºæœ¬

### åŸºæœ¬æ§‹æ–‡

```javascript
// ã€Œasyncã€ã‚’ã¤ã‘ã‚‹ã¨ã€ã“ã®é–¢æ•°ã¯éåŒæœŸé–¢æ•°ã«ãªã‚‹
async function doSomething() {
  
  // ã€Œawaitã€ã§å‡¦ç†ã®å®Œäº†ã‚’å¾…ã¤
  const result = await someAsyncOperation();
  
  // awaitã®å¾Œã®è¡Œã¯ã€ä¸Šã®å‡¦ç†ãŒçµ‚ã‚ã£ã¦ã‹ã‚‰å®Ÿè¡Œã•ã‚Œã‚‹
  console.log(result);
}
```

### ã‚·ãƒ³ãƒ—ãƒ«ãªä¾‹

```javascript
async function sayHello() {
  console.log("æº–å‚™ä¸­...");
  
  // 3ç§’å¾…ã¤ã¨ã„ã†å‡¦ç†ãŒçµ‚ã‚ã‚‹ã®ã‚’ã€Œå¾…æ©Ÿ(await)ã€ã™ã‚‹
  await new Promise(resolve => setTimeout(resolve, 3000));
  
  console.log("ã“ã‚“ã«ã¡ã¯ï¼"); // 3ç§’å¾Œã«ã—ã‹å®Ÿè¡Œã•ã‚Œãªã„
}

sayHello();
console.log("ã“ã®è¡Œã¯å…ˆã«è¡¨ç¤ºã•ã‚Œã‚‹ï¼");
```

**å‡ºåŠ›çµæœï¼š**
```
æº–å‚™ä¸­...
ã“ã®è¡Œã¯å…ˆã«è¡¨ç¤ºã•ã‚Œã‚‹ï¼
ï¼ˆ3ç§’å¾Œï¼‰
ã“ã‚“ã«ã¡ã¯ï¼
```

---

## 3. try...catchã§ã‚¨ãƒ©ãƒ¼å‡¦ç†

### ğŸ›¡ï¸ å®‰å…¨è£…ç½®ã¨ã—ã¦ã®å½¹å‰²

ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã«ã¯äºˆæœŸã›ã¬ã‚¨ãƒ©ãƒ¼ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚‰ãªã„ã€ãƒãƒƒãƒˆãŒåˆ‡ã‚ŒãŸç­‰ï¼‰ãŒã¤ãã‚‚ã®ã§ã™ã€‚

`try...catch` ã¯ã€**ã€Œã¨ã‚Šã‚ãˆãšã“ã‚Œã‚’ã‚„ã£ã¦ã¿ã¦ï¼ˆtryï¼‰ã€ã‚‚ã—å¤±æ•—ã—ãŸã‚‰ã“ã£ã¡ã®å‡¦ç†ã‚’ã—ã¦ï¼ˆcatchï¼‰ã€**ã¨ã„ã†ä»•çµ„ã¿ã§ã™ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  try...catch ãŒãªã„å ´åˆ                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                        â”‚
â”‚  ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ â†’ âŒ ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿï¼      â”‚
â”‚         â†“                              â”‚
â”‚  ğŸ’¥ ãƒ—ãƒ­ã‚°ãƒ©ãƒ å…¨ä½“ãŒåœæ­¢                â”‚
â”‚  ğŸ–¥ï¸ ç”»é¢ãŒçœŸã£ç™½ã«...                   â”‚
â”‚                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  try...catch ãŒã‚ã‚‹å ´åˆ                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                        â”‚
â”‚  try {                                 â”‚
â”‚    ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ â†’ âŒ ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿï¼   â”‚
â”‚  } catch {                             â”‚
â”‚    ğŸ“ã€Œãƒ•ã‚¡ã‚¤ãƒ«ãŒãªã„ã‚ˆã€ã¨ãƒ­ã‚°å‡ºåŠ›      â”‚
â”‚    ğŸ”„ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã‚’ä½¿ç”¨              â”‚
â”‚  }                                     â”‚
â”‚  âœ… ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã¯ç¶™ç¶šï¼                  â”‚
â”‚                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ã‚³ãƒ¼ãƒ‰ä¾‹

```javascript
async function loadData() {
  try {
    // å¤±æ•—ã™ã‚‹ã‹ã‚‚ã—ã‚Œãªã„å‡¦ç†
    const response = await fetch('data.json');
    const data = await response.json();
    console.log('ãƒ‡ãƒ¼ã‚¿å–å¾—æˆåŠŸï¼', data);
  } catch (error) {
    // å¤±æ•—ã—ãŸæ™‚ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
    console.log('ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ:', error.message);
    console.log('ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã‚’ä½¿ã„ã¾ã™ã€‚');
  }
}
```

---

## 4. VRMã§ã®å®Ÿè·µä¾‹

### ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³èª­ã¿è¾¼ã¿ã®å®Ÿä¾‹

ä»Šå›ã®ã‚³ãƒ¼ãƒ‰ã§ã¯ã€`await loader.loadAsync(url)` ã¨ã™ã‚‹ã“ã¨ã§ã€**ã€Œã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ãŒçµ‚ã‚ã‚‹ã¾ã§ã€ãã®å¾Œã®å‡¦ç†ã‚’ã‚¹ãƒˆãƒƒãƒ—ã—ã¦å¾…ã¤ã€**ã¨ã„ã†å‹•ãã‚’å®Ÿç¾ã—ã¦ã„ã¾ã™ã€‚

```javascript
// ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’èª­ã¿è¾¼ã‚€éåŒæœŸé–¢æ•°
async function loadVRMAnimation(vrm, animationUrl) {
  try {
    // â‘  ãƒ­ãƒ¼ãƒ€ãƒ¼ã§ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ï¼ˆæ™‚é–“ãŒã‹ã‹ã‚‹ï¼‰
    const gltf = await loader.loadAsync(animationUrl);
    
    // â‘¡ èª­ã¿è¾¼ã¿å®Œäº†å¾Œã€VRMç”¨ã®ã‚¯ãƒªãƒƒãƒ—ã«å¤‰æ›
    const clip = createVRMAnimationClip(gltf.userData.vrmAnimations[0], vrm);
    
    // â‘¢ ãƒŸã‚­ã‚µãƒ¼ã«ã‚»ãƒƒãƒˆã—ã¦å†ç”Ÿï¼
    const action = mixer.clipAction(clip);
    action.play();
    
    console.log('ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å†ç”Ÿé–‹å§‹ï¼');
    
  } catch (error) {
    // ãƒ•ã‚¡ã‚¤ãƒ«ãŒãªãã¦ã‚‚ã€3Dè¡¨ç¤ºè‡ªä½“ã¯å®ˆã‚‰ã‚Œã‚‹
    console.error('ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³èª­ã¿è¾¼ã¿å¤±æ•—:', error.message);
  }
}
```

### VRMã®3ã¤ã®ã‚­ãƒ¼ãƒ‘ãƒ¼ãƒ„

| ãƒ‘ãƒ¼ãƒ„ | å½¹å‰² | ä¾‹ãˆ |
|-------|------|------|
| `GLTFLoader` + `Plugin` | VRMå½¢å¼ã‚’èª­ã¿è¾¼ã¿å¯èƒ½ã«ã™ã‚‹ | DVDãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼ã«Blu-rayæ©Ÿèƒ½ã‚’è¿½åŠ  |
| `AnimationMixer` | ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å†ç”Ÿã‚’ç®¡ç† | éŸ³æ¥½ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼æœ¬ä½“ |
| `requestAnimationFrame` | æ¯ãƒ•ãƒ¬ãƒ¼ãƒ æç”»ã‚’æ›´æ–° | ãƒ‘ãƒ©ãƒ‘ãƒ©æ¼«ç”»ã‚’ã‚ãã‚‹ä¿‚ |

---

## 5. ãƒãƒ£ãƒ¬ãƒ³ã‚¸å•é¡Œ

### å•é¡Œ1: å®Ÿè¡Œé †åºã‚’äºˆæƒ³ã—ã‚ˆã†

```javascript
async function quiz() {
  console.log('A');
  await new Promise(r => setTimeout(r, 1000));
  console.log('B');
}

console.log('1');
quiz();
console.log('2');
```

<details>
<summary>ç­”ãˆã‚’è¦‹ã‚‹</summary>

**å‡ºåŠ›é †åº:** `1` â†’ `A` â†’ `2` â†’ ï¼ˆ1ç§’å¾Œï¼‰â†’ `B`

**è§£èª¬:** `quiz()`ã¯éåŒæœŸé–¢æ•°ãªã®ã§ã€awaitã®å¾Œã®å‡¦ç†ã‚’å¾…ãŸãšã«æ¬¡ã®`console.log('2')`ãŒå…ˆã«å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚
</details>

### å•é¡Œ2: ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’è¿½åŠ ã—ã‚ˆã†

ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã«try...catchã‚’è¿½åŠ ã—ã¦ã€ã‚¨ãƒ©ãƒ¼ãŒèµ·ãã¦ã‚‚ã€Œãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ¢ãƒ‡ãƒ«ã‚’ä½¿ç”¨ã—ã¾ã™ã€ã¨è¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã†ã«ã—ã¦ãã ã•ã„ã€‚

```javascript
async function loadModel(url) {
  const gltf = await loader.loadAsync(url);
  scene.add(gltf.scene);
}
```

<details>
<summary>ç­”ãˆã‚’è¦‹ã‚‹</summary>

```javascript
async function loadModel(url) {
  try {
    const gltf = await loader.loadAsync(url);
    scene.add(gltf.scene);
  } catch (error) {
    console.log('ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ¢ãƒ‡ãƒ«ã‚’ä½¿ç”¨ã—ã¾ã™');
    // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ¢ãƒ‡ãƒ«ã‚’èª­ã¿è¾¼ã‚€å‡¦ç†ãªã©
  }
}
```
</details>

---

## ğŸ“– æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

éåŒæœŸå‡¦ç†ãŒç†è§£ã§ããŸã‚‰ã€å®Ÿéš›ã«VRMã‚’å‹•ã‹ã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼

ğŸ‘‰ [example-001](../example-001/README.MD) ã§ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å†ç”Ÿã‚’ä½“é¨“ï¼

---

## ğŸ”— å‚è€ƒãƒªãƒ³ã‚¯

- [MDN: async function](https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Statements/async_function)
- [MDN: try...catch](https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Statements/try...catch)